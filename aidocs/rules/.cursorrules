# Sentry Java SDK 文档工程 Cursor Rules

## 🎯 项目概述
这是一个专门用于 Sentry Java SDK 技术文档的工程，包含详细的源码分析、时序图、监控机制等技术文档。

## 📁 项目结构
```
aidocs/
├── README.md                           # 项目总览文档
├── rules/                             # Cursor 规则目录
│   └── .cursorrules                   # 本规则文件
├── mermaid/                           # Mermaid 时序图目录
│   ├── README.md                      # Mermaid 使用说明
│   ├── svg/                          # 生成的 SVG 图像文件
│   └── *.mmd                         # Mermaid 源文件
├── sentry-initialization-flow.md      # 初始化流程分析
├── sentry-crash-monitoring.md         # 崩溃监控分析
├── sentry-startup-monitoring.md       # 启动监控分析
├── sentry-network-monitoring.md       # 网络监控分析
├── sentry-profiling-analysis.md       # 性能分析
├── sentry-replay-analysis.md          # 回放分析
├── sentry-session-management.md       # 会话管理
├── sentry-ui-jank-monitoring.md       # UI卡顿监控
├── sentry-init-quick-reference.md     # 初始化快速参考
└── sentry-initialization-details.md   # 初始化详细说明
```

## 🔧 自动化规则

### 📝 文档修改规则

当用户要求修改或新增文档时，请遵循以下规则：

1. **文档格式标准**：
   - 使用中文作为主要语言
   - 标题使用 `#` 层级结构，最多到 `###`
   - 代码块使用 ```java 或 ```mermaid 标记
   - 文件路径使用 **粗体** 标记：`**文件路径**: path/to/file.java`
   - 类名、方法名使用反引号：`SentryClient`、`init()`

2. **内容结构**：
   - 每个文档都应包含：概述、核心机制、实现细节、配置说明、最佳实践
   - 代码示例必须包含完整的包路径和类名
   - 时序图应该清晰展示组件间的交互流程

3. **技术深度**：
   - 深入到源码级别的分析
   - 包含具体的类名、方法名、文件路径
   - 解释设计模式和架构决策
   - 提供性能优化建议

### 🎨 时序图规则

当用户要求修改或新增时序图时，请遵循以下规则：

1. **Mermaid 语法标准**：
   - 使用 `sequenceDiagram` 类型
   - 参与者命名使用英文，但可以用 `as` 添加中文描述
   - 消息使用 `->>` 表示同步调用，`-->>` 表示异步返回
   - 使用 `Note over` 添加重要说明
   - 使用 `alt/else/end` 表示条件分支
   - 使用 `loop/end` 表示循环

2. **文件管理**：
   - 新的时序图文件保存到 `mermaid/` 目录
   - 文件命名格式：`源文档名-功能描述.mmd`
   - 同时生成对应的 SVG 文件到 `mermaid/svg/` 目录
   - 更新 `mermaid/README.md` 文件列表

3. **内容要求**：
   - 时序图应该准确反映 Sentry Java SDK 的实际执行流程
   - 包含关键的类名和方法调用
   - 标注重要的执行步骤和决策点
   - 体现异常处理和错误恢复机制

### 🔄 自动化操作

当用户提出以下类型的请求时，请自动执行相应操作：

1. **"修改文档"** 或 **"更新文档"**：
   - 直接修改对应的 Markdown 文件
   - 保持现有的格式和结构
   - 添加或更新相关的代码示例

2. **"新增时序图"** 或 **"创建时序图"**：
   - 在 `mermaid/` 目录创建新的 `.mmd` 文件
   - 使用 Mermaid CLI 生成对应的 SVG 文件
   - 更新 `mermaid/README.md` 的文件列表

3. **"更新时序图"** 或 **"修改时序图"**：
   - 修改对应的 `.mmd` 文件
   - 重新生成 SVG 文件
   - 确保语法正确性

4. **"生成图像"** 或 **"转换SVG"**：
   - 使用 `mmdc` 命令批量或单独转换文件
   - 检查转换结果的完整性

## 📚 技术上下文

### Sentry Java SDK 核心组件
- **Sentry**: 主入口类，管理全局状态
- **SentryOptions**: 配置管理类
- **IScopes**: 作用域管理接口
- **SentryClient**: 核心事件处理客户端
- **ITransport**: 网络传输接口
- **Integration**: 框架集成接口

### 关键流程
1. **初始化流程**: 锁获取 → 平台检查 → 配置加载 → 组件创建 → 集成注册
2. **崩溃监控**: 异常捕获 → 事件创建 → 数据收集 → 传输发送
3. **性能监控**: 指标收集 → 数据聚合 → 采样决策 → 上报机制
4. **会话管理**: 会话创建 → 状态跟踪 → 生命周期管理

### 平台特性
- **Android**: 特殊的初始化流程、ANR检测、Native崩溃
- **Java**: 标准JVM环境、Spring集成、多线程处理
- **通用**: 配置系统、传输层、事件处理

## 🎯 响应模式

### 快速响应关键词
- **"时序图"** → 自动处理 Mermaid 相关操作
- **"文档"** → 自动处理 Markdown 文件操作
- **"初始化"** → 关注 sentry-initialization-*.md 文件
- **"崩溃"** → 关注 sentry-crash-monitoring.md 文件
- **"监控"** → 关注相应的监控类文档
- **"配置"** → 关注配置相关的章节

### 自动推理
当用户提到某个功能或组件时，自动关联到相关的文档和时序图：
- 提到 "Android" → 关联 Android 特定的文档和时序图
- 提到 "ANR" → 关联崩溃监控文档中的 ANR 部分
- 提到 "性能" → 关联性能分析和启动监控文档
- 提到 "网络" → 关联网络监控文档

## 🛠️ 工具使用

### Mermaid CLI 命令
```bash
# 生成单个 SVG
mmdc -i filename.mmd -o svg/filename.svg

# 批量生成 SVG
for file in *.mmd; do mmdc -i "$file" -o "svg/${file%.mmd}.svg"; done

# 生成 PNG（高质量）
mmdc -i filename.mmd -o svg/filename.png -s 2

# 生成深色主题
mmdc -i filename.mmd -o svg/filename.svg -t dark
```

### 文件操作模式
- 修改现有文件时，保持原有的格式和结构
- 新增文件时，遵循项目的命名规范
- 更新时序图时，同时更新对应的 SVG 文件
- 修改文档时，检查是否需要更新相关的时序图

## 🔍 质量检查

在完成任何修改后，自动检查：
1. **Markdown 语法**：确保标题、链接、代码块格式正确
2. **Mermaid 语法**：确保时序图语法无误，可以正常渲染
3. **文件引用**：确保文档间的链接和引用正确
4. **中文表达**：确保技术术语的中文表达准确、一致
5. **代码示例**：确保 Java 代码示例语法正确、可执行

## 💡 智能建议

当用户的请求不够明确时，主动提供建议：
- 建议相关的文档章节
- 推荐相应的时序图
- 提供代码示例
- 解释技术概念
- 指出最佳实践

---

**使用说明**: 这个规则文件旨在让 Cursor 能够智能地理解和处理 Sentry Java SDK 文档工程的各种需求，自动化常见的文档和时序图操作，提高工作效率。 